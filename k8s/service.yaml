apiVersion: v1
kind: Service
metadata:
  name: app-service
  namespace: cruder-app
  labels:
    app: cruder
    component: backend
  annotations:
    # Cloud provider specific annotations (uncomment as needed)
    # DigitalOcean example:
    # service.beta.kubernetes.io/do-loadbalancer-protocol: "http"
    # service.beta.kubernetes.io/do-loadbalancer-healthcheck-path: "/api/v1/users/"

    # AWS example:
    # service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
    # service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

    # GCP example:
    # cloud.google.com/load-balancer-type: "External"
spec:
  type: LoadBalancer

  # Session affinity for sticky sessions (optional)
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800

  # External traffic policy
  # "Local" preserves client source IP but may cause uneven load distribution
  # "Cluster" provides better load distribution but loses client IP
  externalTrafficPolicy: Cluster

  ports:
    - name: http
      port: 80
      targetPort: 8080
      protocol: TCP

  selector:
    app: cruder
    component: backend
